<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>验证处理中</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#69b1ff',
                        accent: '#36D399',
                        danger: '#F87272',
                        warning: '#FBBD23',
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }

            .bg-gradient-primary {
                background: linear-gradient(135deg, #165DFF 0%, #69b1ff 100%);
            }

            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }

            .transition-all-300 {
                transition: all 0.3s ease;
            }

            .card-shadow {
                box-shadow: 0 10px 25px -5px rgba(22, 93, 255, 0.1), 0 8px 10px -6px rgba(22, 93, 255, 0.1);
            }

            .pulse-animation {
                animation: pulse 2s infinite;
            }

            @keyframes pulse {
                0% {
                    opacity: 0.6;
                }

                50% {
                    opacity: 1;
                }

                100% {
                    opacity: 0.6;
                }
            }
        }
    </style>
</head>
<body class="font-inter bg-gray-50 min-h-screen flex items-center justify-center p-4">
    <!-- 背景装饰元素 -->
    <div class="fixed inset-0 overflow-hidden -z-10">
        <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-primary/5 to-secondary/5"></div>
        <div class="absolute -top-40 -right-40 w-80 h-80 rounded-full bg-primary/10 blur-3xl"></div>
        <div class="absolute -bottom-40 -left-40 w-80 h-80 rounded-full bg-secondary/10 blur-3xl"></div>
    </div>

    <!-- 主卡片 -->
    <div class="max-w-md w-full mx-auto relative z-10">
        <div class="bg-white rounded-2xl card-shadow overflow-hidden transform transition-all duration-500 hover:shadow-xl">
            <!-- 头部区域 -->
            <div class="bg-gradient-primary p-8 text-white relative overflow-hidden">
                <div class="absolute inset-0 opacity-20">
                    <i class="fa fa-cog text-[200px] absolute -right-20 -bottom-20 transform rotate-12 pulse-animation"></i>
                </div>
                <div class="relative z-10">
                    <h1 class="text-[clamp(1.5rem,3vw,2.25rem)] font-bold text-shadow mb-2">处理中</h1>
                    <p class="opacity-90">正在验证您的请求</p>
                </div>
            </div>

            <!-- 内容区域 -->
            <div class="p-8 space-y-6 text-center">
                <div class="space-y-4">
                    <div class="flex justify-center">
                        <div id="loadingIndicator" class="w-16 h-16 border-4 border-primary/30 border-t-primary rounded-full animate-spin"></div>
                    </div>

                    <h2 class="text-lg font-medium text-gray-800">正在验证您的令牌</h2>
                    <p class="text-gray-600" id="statusMessage">请稍候，系统正在处理您的请求...</p>
                </div>

                <!-- 进度指示器 -->
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="progressBar" class="bg-primary h-2.5 rounded-full transition-all duration-500" style="width: 25%"></div>
                </div>

                <!-- 结果区域 (默认隐藏) -->
                <div id="resultContainer" class="hidden space-y-4 pt-4">
                    <div id="resultIcon" class="text-5xl mx-auto"></div>
                    <h2 id="resultTitle" class="text-xl font-bold text-gray-800"></h2>
                    <p id="resultMessage" class="text-gray-600"></p>

                    <button id="actionButton" class="mt-4 w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg">
                        返回首页
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const loadingIndicator = document.getElementById('loadingIndicator');
            const progressBar = document.getElementById('progressBar');
            const statusMessage = document.getElementById('statusMessage');
            const resultContainer = document.getElementById('resultContainer');
            const resultIcon = document.getElementById('resultIcon');
            const resultTitle = document.getElementById('resultTitle');
            const resultMessage = document.getElementById('resultMessage');
            const actionButton = document.getElementById('actionButton');

            // 解析URL参数
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');

            // 检查是否有token参数
            if (!token) {
                showResult('error', '缺少令牌', 'URL中未包含有效的token参数', 'fa-exclamation-circle', '重新尝试');
                return;
            }

            // 更新进度条
            const updateProgress = function(percent) {
                progressBar.style.width = `${percent}%`;
            };

            // 显示结果
            const showResult = function(type, title, message, iconClass, buttonText) {
                loadingIndicator.classList.add('hidden');
                resultContainer.classList.remove('hidden');

                resultIcon.className = `text-5xl mx-auto ${type === 'success' ? 'text-accent' : type === 'error' ? 'text-danger' : 'text-warning'} ${iconClass}`;
                resultTitle.textContent = title;
                resultMessage.textContent = message;
                actionButton.textContent = buttonText || '返回首页';

                // 平滑显示结果
                resultContainer.style.opacity = '0';
                resultContainer.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    resultContainer.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    resultContainer.style.opacity = '1';
                    resultContainer.style.transform = 'translateY(0)';
                }, 10);
            };

            // 模拟进度
            let progress = 25;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 75) {
                    clearInterval(progressInterval);
                }
                updateProgress(Math.min(progress, 75));
            }, 500);

            // 从API获取配置
            const fetchConfig = function() {
                fetch('/api/fuli/yanzheng.json')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('无法获取配置文件');
                        }
                        return response.json();
                    })
                    .then(data => {
                        updateProgress(85);
                        statusMessage.textContent = '正在验证...';

                        // 模拟处理延迟
                        setTimeout(() => {
                            processToken(data);
                        }, 1000);
                    })
                    .catch(error => {
                        console.error('获取配置失败:', error);
                        showResult('error', '系统错误', '无法获取验证配置，请稍后再试', 'fa-times-circle');
                    });
            };

            // 处理token
            const processToken = function(config) {
                const tokenData = config.tokens.find(item => item.token === token);

                if (!tokenData) {
                    showResult('error', '无效令牌', '您提供的令牌不存在或已过期', 'fa-exclamation-circle');
                    return;
                }

                updateProgress(95);
                statusMessage.textContent = `正在执行操作: ${tokenData.action}...`;

                // 模拟处理延迟
                setTimeout(() => {
                    executeAction(tokenData.action);
                }, 1000);
            };

            // 执行对应操作
            const executeAction = function(action) {
                updateProgress(100);

                switch(action) {
                    case 'clear_login':
                        // 清除登录状态
                        localStorage.removeItem('user_token');
                        localStorage.removeItem('user_data');
                        showResult('success', '登出成功', '您的登录状态已被清除', 'fa-sign-out', '重新登录');
                        actionButton.addEventListener('click', () => {
                            window.location.href = '/login'; // 替换为实际登录页面URL
                        });
                        break;

                    case 'activate':
                        // 激活成功
                        localStorage.setItem('activationStatus', 'active');
                        const thirtyDays = 30 * 24 * 60 * 60 * 1000;
                        const expirationDate = new Date(Date.now() + thirtyDays);
                        localStorage.setItem('activationExpiry', expirationDate.toISOString());
                        showResult('success', '激活成功', '您的账户已成功激活，正在跳转至会员中心...', 'fa-check-circle');

                        // 自动跳转
                        setTimeout(() => {
                            window.location.href = '/dashboard'; // 替换为实际会员中心URL
                        }, 2000);
                        break;

                    case 'lock':
                        // 锁定账户
                        localStorage.setItem('account_locked', 'true');
                        showResult('warning', '账户已锁定', '您的账户已被临时锁定，请联系客服解锁', 'fa-lock', '联系客服');
                        actionButton.addEventListener('click', () => {
                            window.location.href = '/support'; // 替换为实际客服页面URL
                        });
                        break;

                    default:
                        showResult('error', '未知操作', '令牌指定的操作类型无效', 'fa-question-circle');
                }
            };

            // 模拟网络请求延迟
            setTimeout(fetchConfig, 1500);

            // 返回首页按钮
            actionButton.addEventListener('click', () => {
                window.location.href = '/';
            });
        });
    </script>
</body>
</html>